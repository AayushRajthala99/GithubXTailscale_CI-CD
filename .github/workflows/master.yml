name: GithubXTailscale_CI-CD

on:
  push:
    branches:
      - master
    paths:
      - 'backend/**'
      - 'frontend/**'
      - 'docker-compose.yml'

jobs:
  build-and-deploy:
    name: Build and Deploy All Services
    environment: staging
    runs-on: [tailscaleCI-CD]

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      # Install Docker Compose if it's not on your VM
      #- name: Install Docker Compose
      #  run: |
      #    sudo apt-get update
      #    sudo apt-get install -y docker-compose-v2

      # This one command replaces all your 'docker build/stop/rm/run' steps
      - name: Build and Deploy with Docker Compose
        run: docker-compose up -d --build